name: Openwrt PKG Actions

on: 
  # push: 
  #   branches:
  #     - master
  schedule:
    - cron: 30 13 * * 6
  workflow_dispatch:

env:
  SDK_URL: https://downloads.openwrt.org/releases/19.07.4/targets/x86/64/openwrt-sdk-19.07.4-x86-64_gcc-7.5.0_musl.Linux-x86_64.tar.xz

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@main

      - name: Initialization environment
        run: sudo apt install -y libev-dev libc-ares-dev libudns-dev libncurses-dev

      - name: Download OpenWrt SDK
        run: |
          SDK_HOME=$(head -c -8 <<< $(basename $SDK_URL))
          wget $SDK_URL
          tar xf $(basename $SDK_URL) -C ~/
          mv ~/$SDK_HOME ~/sdk

      - name: Download Packages
        run: |
          cd ~/sdk
          # packages url git&svn
          #./scripts/feeds update -a
          #./scripts/feeds install -a

      - name: Compile
        run: |
          #cd ~/sdk
          #make defconfig
          #make V=s

      - name: Upload
        run: |
          echo "hello world"